<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.coreflow.shop.admin.category.AdCategoryMapper">

  <!-- 1차 카테고리 -->
  <select id="FirstCategorystList" resultType="com.coreflow.shop.common.dto.CategoryDTO">
    SELECT cate_code,
		cate_prtcode,
		cate_name,
		cate_order 
	FROM categories 
	WHERE CATE_PRTCODE is null
	ORDER BY cate_order ASC
  </select>

  <select id="SecondCategoryList" parameterType="Integer"
          resultType="com.coreflow.shop.common.dto.CategoryDTO">
    SELECT
      cate_code,
      cate_prtcode,
      cate_name
    FROM categories
    WHERE cate_prtcode = #{firstCategoryCode}
  </select>

  <update id="arrayCategory" parameterType="map">
    UPDATE categories
    SET cate_order = #{order}
    WHERE cate_code = #{cate_code}
  </update>

  <insert id="inputFirstCategory" parameterType="String">
    INSERT INTO categories (cate_prtcode, cate_name, cate_order)
    VALUES (NULL, #{cate_name}, 1)
  </insert>

  <update id="modifyFirstCategory"
          parameterType="com.coreflow.shop.common.dto.CategoryDTO">
    UPDATE categories
    SET cate_name = #{cate_name}
    WHERE cate_code = #{cate_code}
  </update>

  <insert id="plusSecondCategory"
          parameterType="com.coreflow.shop.common.dto.CategoryDTO">
    INSERT INTO categories (cate_prtcode, cate_name, cate_order)
    VALUES (#{cate_prtcode}, #{cate_name}, 1)
  </insert>

  <update id="secondModifyCategory"
          parameterType="com.coreflow.shop.common.dto.CategoryDTO">
    UPDATE categories
    SET cate_name = #{cate_name},
        cate_prtcode = #{cate_prtcode}
    WHERE cate_code = #{cate_code}
  </update>

  <delete id="deleteCategory" parameterType="Integer">
    DELETE FROM categories
    WHERE cate_code = #{cate_code}
  </delete>

  <!-- ✅ 추가: 상품수정용 메서드 2개 -->
  <select id="gCSecondCategory"
          resultType="com.coreflow.shop.common.dto.CategoryDTO">
    SELECT parent.cate_code,
           parent.cate_name,
           parent.cate_prtcode
    FROM categories AS child
    JOIN categories AS parent
      ON child.cate_prtcode = parent.cate_code
    WHERE child.cate_code = #{secondCategory}
  </select>

  <select id="secondplusList"
          resultType="com.coreflow.shop.common.dto.CategoryDTO">
    SELECT cate_code, cate_name, cate_prtcode
    FROM categories
    WHERE cate_prtcode = #{firstCategory}
    ORDER BY cate_order ASC
  </select>

</mapper>


