<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<th:block th:fragment="header">
<header>
  <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
    <div class="container-fluid">
      <a class="navbar-brand coreflow-logo fw-bold" href="/">COREFLOW2</a>
     
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse"
        aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse d-flex align-items-center" id="navbarCollapse">
        <ul class="navbar-nav me-auto mb-2 mb-md-0">
          <li class="nav-item">
			<a class="nav-link" href="/">
			  <i class="bi bi-house-door-fill me-1"></i>Home
			</a>
          </li>

          <th:block th:if= "${session.login_auth == null and session.kakao_login_auth == null}">
            <li class="nav-item">
              <a class="nav-link" href="/member/login">
                <i class="bi bi-person-fill me-1"></i>Login
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/member/join">
                <i class="bi bi-person-plus-fill me-1"></i>Join
              </a>
            </li>
          </th:block>

          <th:block th:if= "${session.login_auth != null or session.kakao_login_auth != null}">
            
            <li class="nav-item">
              <a class="nav-link" href="/cart/cart_list">
                <i class="bi bi-cart me-1"></i>Cart
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/order/order_info?type=buy">
                <i class="bi bi-shop-window me-1"></i>Order
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/member/mypage">
                <i class="bi bi-person-badge me-1"></i>MyPage
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/member/logout">
                <i class="bi bi-box-arrow-right me-1"></i>Logout
              </a>
            </li>
            
            <li class="nav-item">
              <a class="nav-link" href="/chatapi/chatForm">
                <i class="bi bi-chat-dots me-1"></i>QnA
              </a>
            </li>
            
          </th:block>
        </ul>

        <div class="position-relative">
          <button class="btn btn-outline-light" id="searchBtn">
            <i class="bi bi-search"></i>
          </button>

          <div class="search-box d-none position-absolute end-0 mt-2">
            <form class="d-flex" role="search" action="/product/search" method="get">
              <input class="form-control me-2" type="search" placeholder="검색어를 입력하세요" name="keyword">
              <button class="btn btn-dark" type="submit">
                <i class="bi bi-search"></i> Search
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>

<style>
/* 검색창 스타일 */
.search-box {
  width: 300px;
  z-index: 1050;
  background-color: #fff;
  padding: 0.5rem;
  border-radius: 5px;
  box-shadow: 0 0.3rem 0.6rem rgba(0, 0, 0, 0.2);
}

/* 검색 input 작게 */
.search-box input {
  width: 180px;
}

/* 돋보기 버튼 */
#searchBtn {
  font-size: 1.1rem;
}

/* 아이콘과 텍스트 간격 조절 */
.nav-link i {
  margin-right: 0.25rem;
}

/* Coreflow 로고 스타일 */
.coreflow-logo {
  font-size: 1.5rem;
  letter-spacing: 0.03rem;
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

/* 전체 메뉴 텍스트 폰트 스타일 (고급스럽게) */
.navbar-nav .nav-link {
  position: relative;
  font-size: 0.95rem;
  text-decoration: none;
  color: rgba(255, 255, 255, 0.75);
  transition: color 0.3s ease-in-out;
}

/* 호버 시 밑줄 효과를 위한 의사 요소 */
.navbar-nav .nav-link::after {
  content: '';
  position: absolute;
  width: 0;
  height: 2px;
  background-color: #fff;
  bottom: -5px;
  left: 50%;
  transform: translateX(-50%);
  transition: width 0.3s ease-in-out;
}

/* 호버 효과: 텍스트 색상 및 밑줄 애니메이션 */
.navbar-nav .nav-link:hover {
  color: #fff;
}

.navbar-nav .nav-link:hover::after {
  width: 100%;
}

/* 현재 활성화된 링크는 호버 효과와 동일하게 밑줄 표시 */
.navbar-nav .nav-link.active::after {
    width: 100%;
}
</style>

<script>
$(document).ready(function(){
    // 돋보기 클릭 → 검색창 토글
    $("#searchBtn").click(function(e){
        e.preventDefault();
        $(".search-box").toggleClass("d-none");
        $(".search-box input").focus();
    });

    // 검색창 외 클릭 시 닫기
    $(document).click(function(e) {
        if(!$(e.target).closest('.search-box, #searchBtn').length) {
            $(".search-box").addClass("d-none");
        }
    });

    // 현재 페이지의 URL 경로를 가져옵니다.
    var currentPath = window.location.pathname;

    // 모든 메뉴 링크에서 'active' 클래스를 제거합니다.
    $('.navbar-nav .nav-link').removeClass('active');

    // 현재 경로와 일치하는 링크에만 'active' 클래스를 추가합니다.
    $('.navbar-nav .nav-link').each(function() {
        var href = $(this).attr('href');
        // 'href'가 '/home'과 같이 경로만 있거나, 쿼리 파라미터가 있는 경우에도 처리합니다.
        if (href === currentPath || href.split('?')[0] === currentPath) {
            $(this).addClass('active');
        }
    });
});
</script>

</th:block>
</html>