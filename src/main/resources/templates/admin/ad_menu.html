<!DOCTYPE html>
<!-- 레이아웃을 상속 받는 내용. (nav, aside, footer) 와 다름 -->
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{admin/layouts/ad_layout.html}">

	<!-- Chart.js 및 jQuery UI -->
	<th:block layout:fragment="script1">
	<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
	<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
	</th:block>

	<th:block layout:fragment="content">
	<div class="container mt-5">
		<div class="row">
			<div class="col">
				<div class="card card-primary">
					<div class="card-header">
					  <h3 class="card-title">매출통계 대시보드</h3>
					</div>

					<div class="card-body">
						<!-- ✅ 핵심 현황 카드 -->
						<div class="row mb-4 text-center">
						  <div class="col">
						    <div class="card bg-light">
						      <div class="card-body">
						        <h6>오늘 주문수</h6>
						        <h4 th:text="${todayOrderCount}"></h4>
						      </div>
						    </div>
						  </div>
						  <div class="col">
						    <div class="card bg-light">
						      <div class="card-body">
						        <h6>오늘 매출액</h6>
						        <h4 th:text="${todaySalesTotal} + '원'"></h4>
						      </div>
						    </div>
						  </div>
						  <div class="col">
						    <div class="card bg-light">
						      <div class="card-body">
						        <h6>이번달 환불건수</h6>
						        <h4 th:text="${refundCount}"></h4>
						      </div>
						    </div>
						  </div>
						  <div class="col">
						    <div class="card bg-light">
						      <div class="card-body">
						        <h6>신규 회원 수</h6>
						        <h4 th:text="${newMemberCount}"></h4>
						      </div>
						    </div>
						  </div>
						</div>

						<!-- ✅ 이번달 및 상품 현황 -->
						<div class="row mb-5">
							<div class="col">
								<h6>이번달 거래현황</h6>
								<b>거래수</b><p th:text="${monthlyCount}"></p>
								<b>총매출 금액</b><p th:text="${monthlySalesTotal}"></p>
							</div>
							<div class="col">
								<h6>현재상품현황</h6>
								<b>총상품 수</b><p th:text="${totalProductCount}"></p>
								<b>품절상품 수</b><p th:text="${soldOutProductCount}"></p>
							</div>
						</div>

						<!-- ✅ 통계 차트 영역 -->
						<div class="row mt-5">
							<div class="col">
								<b>거래 카테고리 통계</b><br>
								<canvas id="categoryPieChart" style="width: 250px; height: 250px;"></canvas>
							</div>
							<div class="col">
								<b>이번주 거래금액 통계</b><br>
								<canvas id="thisWeekOrderAmountChart" style="width:250px; height:250px"></canvas>
							</div>
						</div>

						<!-- ✅ 최근 주문 내역 -->
						<div class="mt-5">
						  <h6>최근 주문 내역</h6>
						  <table class="table table-striped">
						    <thead>
						      <tr>
						        <th>주문번호</th>
						        <th>고객명</th>
						        <th>상품명</th>
						        <th>금액</th>
						        <th>주문일</th>
						        <th>상태</th>
						      </tr>
						    </thead>
						    <tbody>
						      <tr th:each="order : ${recentOrders}">
						        <td th:text="${order.orderid}"></td>
						        <td th:text="${order.customername}"></td>
						        <td th:text="${order.productname}"></td>
						        <td th:text="${order.totalamount} + '원'"></td>
						        <td th:text="${#dates.format(order.orderdate, 'yyyy-MM-dd')}"></td>
						        <td th:text="${order.status}"></td>
						      </tr>
						    </tbody>
						  </table>
						</div>

					</div> <!-- card-body -->
				</div>
			</div>
		</div>
	</div>
	</th:block>

	<th:block layout:fragment="script2">
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>	
	<script th:inline="javascript">
	$(document).ready(function() {

	    categoryChart();
		thisWeekOrderAmountChart();

		function categoryChart() {
			const ctx = document.getElementById('categoryPieChart').getContext('2d');
			new Chart(ctx, {
				type: 'pie',
				data: {
					labels: [[${labels1}]],
					datasets: [{
						label: "1차카테고리",
						data: [[${data1}]],
						backgroundColor: ['#FF6384','#36A2EB','#FFCE56','#4BC0C0','#9966FF'],
						borderWidth: 1
					}]
				},
				options: { responsive: true }
			});
		}

		function thisWeekOrderAmountChart() {
			const ctx = document.getElementById('thisWeekOrderAmountChart').getContext('2d');
			new Chart(ctx, {
				type: 'bar',
				data: {
					labels: [[${labels2}]],
					datasets: [{
						label: "이번주 거래금액",
						data: [[${data2}]],
						backgroundColor: ['#36A2EB','#4BC0C0','#FFCE56','#FF6384','#9966FF'],
						borderWidth: 1
					}]
				},
				options: {
					scales: { y: { beginAtZero: true } }
				}
			});
		}
	});	
	</script>
	</th:block>
</html>