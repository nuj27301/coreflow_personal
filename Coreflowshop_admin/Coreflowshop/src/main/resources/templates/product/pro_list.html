<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}">

<head>
  <style>
    body {
      background-color: #f8f9fa;
      font-family: 'Segoe UI', sans-serif;
      padding: 30px 0;
    }

    /* í˜ì´ì§€ ì œëª© */
    h3 {
      font-weight: bold;
      font-size: 1.75rem;
      margin-bottom: 30px;
    }

    /* ìƒí’ˆ ì¹´ë“œ */
    .card {
      background: #fff;
      border-radius: 16px;
      padding: 0;
      margin-bottom: 30px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
      transition: transform 0.2s;
    }

    .card:hover {
      transform: translateY(-3px);
    }

    .card-img-top {
      border-top-left-radius: 16px;
      border-top-right-radius: 16px;
      object-fit: cover;
    }

    .card-body {
      padding: 16px;
      display: flex;
      flex-direction: column;
    }

    .card-title {
      font-weight: bold;
      font-size: 1.1rem;
      margin-bottom: 8px;
    }

    .text-primary {
      color: #000 !important;
      font-weight: 600;
    }

    /* ì¬ê³  ë°°ì§€ ìƒ‰ìƒ í†µì¼ */
    .badge.bg-success {
      background-color: #000 !important; /* ì¬ê³  ìˆìŒ â†’ ê²€ì •ìƒ‰ */
      color: #fff !important;
    }
    .badge.bg-danger {
      background-color: #dc3545 !important; /* í’ˆì ˆ â†’ ë¶‰ì€ìƒ‰ */
      color: #fff !important;
    }

    input[type="number"] {
      border-radius: 12px;
      border: 1px solid #ccc;
      padding: 5px 10px;
      width: 100%;
    }

    /* ë²„íŠ¼ í†µì¼ */
    .btn-primary {
      background: #000;
      border: none;
      color: #fff;
      border-radius: 12px;
      font-weight: bold;
      padding: 6px 10px;
      transition: background 0.3s, color 0.3s;
    }
    .btn-primary:hover {
      background: #333;
    }

    .btn-outline-primary {
      border: 2px solid #000;
      background-color: transparent;
      color: #000;
      border-radius: 12px;
      font-weight: 600;
    }
    .btn-outline-primary:hover {
      background-color: #000;
      color: #fff;
    }

    /* ì¹´ë“œ ë²„íŠ¼ ê·¸ë£¹ */
    .card .mt-auto {
      margin-top: auto;
    }
    .card .d-flex.gap-2 > form {
      flex: 1;
    }

    /* í˜ì´ì§€ë„¤ì´ì…˜ */
    .pagination .page-link {
      border-radius: 12px;
      margin: 0 3px;
      padding: 6px 12px;
      color: #000;
      border: 1px solid #ddd;
    }
    .pagination .page-item.active .page-link {
      background-color: #000;
      color: #fff;
      border: 1px solid #000;
    }
  </style>
</head>

<th:block layout:fragment="content">
  <div class="row">
    <div class="col text-center mb-3 mt-3">
      <h3 th:utext="${cate_name}"></h3>
    </div>
  </div>

  <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3">
    <div class="col" th:each="productDTO : ${productList}">
      <div class="card shadow-sm h-100">

        <!-- ìƒí’ˆ ì´ë¯¸ì§€ -->
        <img th:src="|/product/image_display?dateFolderName=${productDTO.pro_up_folder}&fileName=s_${productDTO.pro_img}|"
             class="card-img-top"
             alt="ìƒí’ˆ ì´ë¯¸ì§€"
             height="255">

        <div class="card-body d-flex flex-column">
          <!-- ìƒí’ˆ ì œëª© -->
          <h5 class="card-title text-truncate fw-bold mb-2"
              th:text="${productDTO.pro_name}"
              title="ìƒí’ˆ ì œëª©">
            ìƒí’ˆ ì œëª©
          </h5>

          <!-- ê°€ê²© -->
          <p class="mb-1 fs-5 text-primary fw-semibold">
            <span th:text="${#numbers.formatInteger(productDTO.pro_price, 3, 'COMMA')}"></span> ì›
          </p>

          <!-- ì¬ê³  ìƒíƒœ -->
          <p class="mb-3">
            <span th:if="${productDTO.pro_amount > 0}" class="badge bg-success">
              ì¬ê³ : <span th:text="${productDTO.pro_amount}"></span> ê°œ
            </span>
            <span th:if="${productDTO.pro_amount == 0}" class="badge bg-danger">
              í’ˆì ˆ
            </span>
          </p>

          <!-- ìˆ˜ëŸ‰ ì„ íƒ -->
          <div class="mb-3" th:if="${productDTO.pro_amount > 0}">
            <label class="form-label small mb-1">êµ¬ë§¤ ìˆ˜ëŸ‰</label>
            <input type="number"
                   class="form-control form-control-sm"
                   name="quantity"
                   min="1"
                   th:max="${productDTO.pro_amount}"
                   th:value="1">
          </div>

          <div class="mt-auto d-flex justify-content-between gap-2">
            <!-- ì¥ë°”êµ¬ë‹ˆ -->
            <form th:action="@{/cart/add}" method="post" class="flex-fill">
              <input type="hidden" name="pro_num" th:value="${productDTO.pro_num}">
              <input type="hidden" name="quantity" value="1" class="selected-qty">
              <button type="button" name="btn_cart_add" th:data-pro_num="${productDTO.pro_num}" class="btn btn-outline-primary btn-sm w-100">ğŸ›’ ì¥ë°”êµ¬ë‹ˆ</button>
            </form>

            <!-- êµ¬ë§¤í•˜ê¸° -->
            <form th:action="@{/order/now}" method="post" class="flex-fill">
              <input type="hidden" name="pro_num" th:value="${productDTO.pro_num}">
              <input type="hidden" name="quantity" value="1" class="selected-qty">
              <button type="button" name="btn_direct_buy" th:data-pro_num="${productDTO.pro_num}" class="btn btn-primary btn-sm w-100">ğŸ’³ êµ¬ë§¤í•˜ê¸°</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
  <div class="row mt-5">
    <div class="col">
      <nav aria-label="Page navigation example">
        <ul class="pagination justify-content-center">
          <th:block th:if="${pageMaker.prev}">
            <li class="page-item"><a class="page-link" th:href="|/product/pro_list${pageMaker.makeSearch(pageMaker.startPage-1)}&cate_code=${cate_code}|">Previous</a></li>
          </th:block>

          <th:block th:each="num : ${#numbers.sequence(pageMaker.startPage, pageMaker.endPage)}">
            <li class="page-item" th:classappend="${pageMaker.cri.page == num ? 'active' : ''}"><a class="page-link" th:href="|/product/pro_list${pageMaker.makeSearch(num)}&cate_code=${cate_code}|" th:text="${num}"></a></li>
          </th:block>

          <th:block th:if="${pageMaker.next}">
            <li class="page-item"><a class="page-link" th:href="|/product/pro_list${pageMaker.makeSearch(pageMaker.endPage+1)}&cate_code=${cate_code}|">Next</a></li>
          </th:block>
        </ul>
      </nav>
    </div>
  </div>

</th:block>

<th:block layout:fragment="script2">
<script th:inline="javascript">
  $(document).ready(function() {

    $("button[name='btn_cart_add']").on("click", function() {
      let pro_num = $(this).data("pro_num");
      let cart_amount = $(this).parents("div.card").find("input[name='quantity']").val();

      $.ajax({
        url: '/cart/cart_add',
        type: 'post',
        data: {pro_num: pro_num, cart_amount: cart_amount},
        dataType: 'text',
        success: function(data) {
          if(data == "success") {
            alert("ì¥ë°”êµ¬ë‹ˆì— ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤");
            if(confirm("ì¥ë°”êµ¬ë‹ˆë¡œ ì´ë™í•˜ê² ìŠµë‹ˆê¹Œ?")) {
              location.href = "/cart/cart_list";
            }
          }
        }
      });
    });

    $("button[name='btn_direct_buy']").on("click", function() {
      let pro_num = $(this).data("pro_num");
      let buy_amount = $(this).parents("div.card").find("input[type='number'][name='quantity']").val();
      location.href = `/order/order_info?pro_num=${pro_num}&cart_amount=${buy_amount}&type=buy`;
    });

  });
</script>
</th:block>

</html>
